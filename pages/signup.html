<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <title>Sign Up Page</title>
        <link rel = "stylesheet" href ="../css/master.css">
        <link rel = "stylesheet" href ="../css/styles.css">
        <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" 
              rel="stylesheet" 
              integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" 
              crossorigin="anonymous">
        <style>
            body 
            {
                font-family: Arial, sans-serif;
                color: #0F292F;
                background-color: #e2c2b3; 
                background-image: url("../img/tools.jpg");
                background-repeat: no-repeat;
                background-attachment: fixed;
                background-position: center;
                background-size: 100% 100%; /* Stretch the image to cover the background */
                height: 100%;
            }
            
            h1, p
            {
                text-align: center;
                color: #f1f2f3;
            }

            button
            {
                margin: 10px 50px;
            }

            input, select
            {
                width: 100%;
            }

            label[for="mname"], label[for="suf"]
            {
                left: 5%;
            }

            #mname
            {
                text-align: center;
                width: 47.5px;
            }

            #suf
            {
                text-align: center;
                width: 75px;
            }

            .row:nth-child(1)
            {
                margin-bottom: 0px !important;
            }

            .row:nth-child(3), .row:nth-last-child(3)
            {
                margin-bottom: 24px !important;
            }

            .form-floating
            {
                margin: 3px 0px;
            }

            .form-select
            {
                height: 58px;
                margin-top: 3px;
            }

            .form-control, .form-select
            {
                border-radius: 1;
                border: 1px solid black;
            }

            .btnCenter
            {
                display: flex;
                flex-wrap: wrap;
                justify-content: center;
            }

            .glassy_signup
            {
                display: flex;
                flex-direction: column;
                height: 650px;
                width: 700px;
                /*Border*/
                align-items: center;
                margin: auto;
                margin-top: 50px;
                background-color: #40323499;
                backdrop-filter: blur(2px);
                box-shadow: inset -5px -5px #68747799;
                border-radius: 25px;
            }

            /* For responsiveness */
            @media screen and (max-width: 768px)
            {
                input, select
                {
                    width: calc(100% - 30px);
                }
                
                .glassy_signup
                {
                    height: auto;
                    width: 95%;
                    max-width: 620px;
                }
            }

            @media screen and (max-width: 575px)
            {
                label[for="mname"], label[for="suf"]
                {
                    left: .5%;
                }

                .col-sm
                {
                    margin-bottom: 5px;
                }
            }

            @media screen and (min-width: 552px)
            {
                .wbtn
                {
                    width: 150px;
                }
            }

            @media screen and (max-width: 552px)
            {
                .btnCenter
                {
                    flex-direction: column-reverse;
                }
            }
        </style>
    </head>
    <body>
        <!-- Navigation Bar -->
        <div class="nav">
            <a href="../index.html">Home</a>
            <a href = "./login.html">Log in</a> 
            <a class = "active" href ="./signup.html">Sign up</a> 
            <a href ="./groupcalendar.html">Group Calendar</a> 
            <a href="./individual_Calender.html">Individual Calendar</a>
        </div>
        <!-- This form is centered on the page and has floating placeholder / label values -->
        <div class="container d-flex justify-content-center glassy_signup">
            <h1>Sign up</h1>
            <p>Please fill in the following fields to create an account.</p>
            <form id="signup" method="POST">
                <!-- 1st Row: Name -->
                <div class="row mb-1">
                    <label style="color: #e2c2b3">Your Name*</label>
                    <div class="col-auto">
                        <div class="form-floating">
                            <input type="text" class="form-control" placeholder="First Name*" id="fname" name="fname" required>
                            <label for="fname">First Name*</label>
                        </div>
                    </div>
                    <div class="col-auto">
                        <div class="form-floating">
                            <input type="text" class="form-control" placeholder="MI" id="mname" name="mname" maxlength="1">
                            <label for="mname">MI</label>
                        </div>
                    </div>
                    <div class="col-auto">
                        <div class="form-floating">
                            <input type="text" class="form-control" placeholder="Last Name*" id="lname" name="lname" required>
                            <label for="lname">Last Name*</label>
                        </div>
                    </div>
                    <div class="col-auto">
                        <div class="form-floating">
                            <input type="text" class="form-control" placeholder="Suffix" id="suf" name="suf" maxlength="6">
                            <label for="suf">Suffix</label>
                        </div>
                    </div>
                </div>
                <!-- 2nd Row: Date of Birth -->
                <div class="row mb-1">
                    <label style="color: #e2c2b3">Date of Birth*</label>
                    <div class="col-sm">
                        <select class="form-select" placeholder="Day*" id="day" name="day" required>
                            <option disabled selected>Day*</option>
                        </select>
                    </div>
                    <div class="col-sm">
                        <select class="form-select" placeholder="Month*" id="month" name="month" required>
                            <option disabled selected>Month*</option>
                        </select>
                    </div>
                    <div class="col-sm">
                        <select class="form-select" placeholder="Year*" id="year" name="year" required>
                            <option disabled selected>Year*</option>
                        </select>
                    </div>
                </div>
                <!-- 3rd Row: Contact Information -->
                <div class="row mb-1">
                    <label style="color: #e2c2b3">Contact Information*</label>
                    <div class="col-sm">
                        <div class="form-floating">
                            <input type="tel" class="form-control" placeholder="Phone Number*" pattern="[0-9]{3}-[0-9]{3}-[0-9]{4}" id="phone" name="phone" required>
                            <label for="phone">Phone Number*</label>
                        </div>
                    </div>
                    <div class="col-sm">
                        <div class="form-floating">
                            <input type="email" class="form-control" placeholder="Email*" pattern="[a-zA-Z0-9._%+\-]+@[a-zA-Z0-9.\-]+\.[a-zA-Z]{2,}(?:\.[a-zA-Z]{2,})?" id="email" name="email" required>
                            <label for="email">Email*</label>
                        </div>
                    </div>
                </div>
                <!-- 4th Row: Address -->
                <div class="row mb-1">
                    <div class="col-sm">
                        <div class="form-floating">
                            <input type="text" class="form-control" placeholder="Address" id="addr" name="addr">
                            <label for="addr">Address</label>
                        </div>
                    </div>
                    <div class="col-sm">
                        <div class="form-floating">
                            <input type="text" class="form-control" placeholder="City" id="city" name="city">
                            <label for="city">City</label>
                        </div>
                    </div>
                    <div class="col-sm">
                        <select class="form-select" placeholder="State" id="state" name="state">
                            <option disabled selected>State</option>
                        </select>                            
                    </div>
                    <div class="col-sm">
                        <div class="form-floating">
                            <input type="text" class="form-control" placeholder="Zip" id="zip" name="zip" maxlength="5">
                            <label for="zip">Zip</label>
                        </div>
                    </div>
                </div>
                 <!-- 5th Row: Username and Password -->
                <div class="row mb-1">
                    <div class="col-sm">
                        <div class="form-floating">
                            <input type="text" class="form-control" placeholder="Username" id="userID" name="userID">
                            <label for="userID">Username</label>
                        </div>
                    </div>
                    <div class="col-sm">
                        <div class="form-floating">
                            <input type="password" class="form-control" placeholder="Password*" id="pwd" name="pwd" required>
                            <label for="pwd">Password*</label>
                        </div>
                    </div>
                    <div class="col-sm">
                        <div class="form-floating">
                            <input type="password" class="form-control" placeholder="Confirm Password*" id="cpwd" name="cpwd" required>
                            <label for="cpwd">Confirm Password*</label>
                        </div>
                    </div>
                </div>
    
                <div class="btnCenter">
                    <button type="reset" class="btn btn-dark wbtn">Cancel</button>
                    <button type="submit" class="btn btn-dark wbtn">Signup</button>
                </div>
            </form>
        </div>

        <!-- JavaScript for collecting the form values and converting it to a JSON string object -->
        <script type="text/javascript">
            document.addEventListener("DOMContentLoaded", function() 
            {
                // Format user's phone number as they type
                document.getElementById('phone').addEventListener('input', function(event)
                {
                    // Removes non-numeric characters
                    let phone = event.target.value.replace(/\D/g, '').substring(0, 10);

                    // Formats phone number as 123-456-7890
                    let formatPhone = phone.replace(/(\d{3})(\d{3})(\d{4})/, '$1-$2-$3');
                    event.target.value = formatPhone;
                });

        // _________________________________________________________________________________________________________________________ 

                // Populate the Day dropdown menu with the number of days depending on the month selected
                let dayDrop = document.getElementById('day');

                // Clear existing options
                // Need this since the dropdown menu is dynamically changing
                dayDrop.innerHTML = '<option disabled selected>Day*</option>';

                // Initially populate the Day dropdown menu
                for (let d=1; d<=31; d++)
                {
                    let opt = document.createElement("option");
                    opt.text = d;
                    opt.value = d;
                    dayDrop.appendChild(opt);
                }

                // Event listeners for dynamically changing the number of days based off the selected month or year
                document.getElementById('month').addEventListener("change", updateDays);
                document.getElementById('year').addEventListener("change", updateDays);

                function updateDays()
                {
                    let sMonth = document.getElementById('month').value;
                    let sYear = document.getElementById('year').value;
                    let sDay = dayDrop.value;

                    // If the month or year dropdown menus have not been selected, stop execution of this function
                    // This helps to only update the days when a month is selected,
                    // so all 31 days are shown until the month and year are chosen, 
                    // after which it updates the days for that specific month
                    if (isNaN(sMonth) || isNaN(sYear)) 
                        return; 

                    let dMonth = new Date(sYear, sMonth, 0).getDate();

                    dayDrop.innerHTML = '<option disabled selected>Day*</option>';

                    // Create option elements where both the displayed text and value are the days
                    for (let d=1; d<=dMonth; d++)
                    {
                        let opt = document.createElement("option");
                        opt.text = d;
                        opt.value = d;
                        dayDrop.appendChild(opt);
                    }

                    // Check if the inputted year is a leap year, and also make sure the month is February
                    if (sMonth === 2 && isLY(sYear))
                    {
                        let f = 29;
                        dayDrop.innerHTML = '<option disabled selected>Day*</option>';

                        for (let d=1; d<=f; d++)
                        {
                            let opt = document.createElement("option");
                            opt.text = d;
                            opt.value = d;
                            dayDrop.appendChild(opt);
                        }
                    }

                    // If a user selects the day first before selecting the month, 
                    // keep the selected day and do not clear the dropdown bar
                    if (sDay <= dMonth)
                    {
                        dayDrop.value = sDay;
                    }

                    // Function to check if a year is a leap year
                    // Leap years happen every 4 years, except if the year is divisible by 100,
                    // however if the year is divisible by 400 it is a leap year
                    function isLY(y)
                    {
                        return (y % 4 == 0 && y % 100 != 0) || (y % 400 == 0);
                    }
                }

        // _________________________________________________________________________________________________________________________

                // Populate the Month dropdown menu with the full name of all months in a year
                let monthDrop = document.getElementById('month');
                // month.innerHTML = '<option>Month*</option>';
                let months = 
                [
                    "January", "February", "March", "April", "May", "June", 
                    "July", "August", "September", "October", "November", "December"
                ];

                // Create option elements where the displayed text is the month and the value is the respective numeric counterpart
                months.forEach(function(m, i)
                {
                    let opt = document.createElement("option");
                    opt.text = m;
                    opt.value = i + 1;
                    monthDrop.appendChild(opt);
                });

        // _________________________________________________________________________________________________________________________

                // Populate the Year dropdown menu with years ranging from 1902 - Today
                // This will change every year as the oldest person to ever live was 122 years old
                let yearDrop = document.getElementById('year');
                let curYear = new Date().getFullYear();
                let startYear = curYear - 122;

                // Create option elements where both the displayed text and value are the year
                for (let y=startYear; y<=curYear; y++)
                {
                    let opt = document.createElement("option");
                    opt.text = y;
                    opt.value = y;
                    yearDrop.appendChild(opt);
                }

        // _________________________________________________________________________________________________________________________

                // Populate the Select State dropdown menu with all 50 states in the US
                let selectState = document.getElementById('state');
                let states = 
                [
                    {name: "Alabama", abbr: "AL"},
                    {name: "Alaska", abbr: "AK"},
                    {name: "Arizona", abbr: "AZ"},
                    {name: "Arkansas", abbr: "AR"},
                    {name: "California", abbr: "CA"},
                    {name: "Colorado", abbr: "CO"},
                    {name: "Connecticut", abbr: "CT"},
                    {name: "Delaware", abbr: "DE"},
                    {name: "Florida", abbr: "FL"},
                    {name: "Georgia", abbr: "GA"},
                    {name: "Hawaii", abbr: "HI"},
                    {name: "Idaho", abbr: "ID"},
                    {name: "Illinois", abbr: "IL"},
                    {name: "Indiana", abbr: "IN"},
                    {name: "Iowa", abbr: "IA"},
                    {name: "Kansas", abbr: "KS"},
                    {name: "Kentucky", abbr: "KY"},
                    {name: "Louisiana", abbr: "LA"},
                    {name: "Maine", abbr: "ME"},
                    {name: "Maryland", abbr: "MD"},
                    {name: "Massachusetts", abbr: "MA"},
                    {name: "Michigan", abbr: "MI"},
                    {name: "Minnesota", abbr: "MN"},
                    {name: "Mississippi", abbr: "MS"},
                    {name: "Missouri", abbr: "MO"},
                    {name: "Montana", abbr: "MT"},
                    {name: "Nebraska", abbr: "NE"},
                    {name: "Nevada", abbr: "NV"},
                    {name: "New Hampshire", abbr: "NH"},
                    {name: "New Jersey", abbr: "NJ"},
                    {name: "New Mexico", abbr: "NM"},
                    {name: "New York", abbr: "NY"},
                    {name: "North Carolina", abbr: "NC"},
                    {name: "North Dakota", abbr: "ND"},
                    {name: "Ohio", abbr: "OH"},
                    {name: "Oklahoma", abbr: "OK"},
                    {name: "Oregon", abbr: "OR"},
                    {name: "Pennsylvania", abbr: "PA"},
                    {name: "Rhode Island", abbr: "RI"},
                    {name: "South Carolina", abbr: "SC"},
                    {name: "South Dakota", abbr: "SD"},
                    {name: "Tennessee", abbr: "TN"},
                    {name: "Texas", abbr: "TX"},
                    {name: "Utah", abbr: "UT"},
                    {name: "Vermont", abbr: "VT"},
                    {name: "Virginia", abbr: "VA"},
                    {name: "Washington", abbr: "WA"},
                    {name: "West Virginia", abbr: "WV"},
                    {name: "Wisconsin", abbr: "WI"},
                    {name: "Wyoming", abbr: "WY"}
                ];

                // Create option elements where the displayed text is the State's full name and the value is the abbreviation
                states.forEach(function(state)
                {
                    let opt = document.createElement("option");
                    opt.text = state.name;
                    opt.value = state.abbr;
                    selectState.appendChild(opt);
                });

        // _________________________________________________________________________________________________________________________

                document.getElementById('signup').addEventListener('submit', function(event)
                {
                    // Prevent the signup button from submitting normally to an action file
                    event.preventDefault();

                    function checkPWD(pwd, cpwd)
                    {
                        return pwd === cpwd;
                    }

                    // Get form values
                    const fname = document.getElementById('fname').value.toUpperCase();
                    const mname = document.getElementById('mname').value.toUpperCase();
                    const lname = document.getElementById('lname').value.toUpperCase();
                    const suf = document.getElementById('suf').value.toUpperCase();
                    const phone = document.getElementById('phone').value;
                    const addr = document.getElementById('addr').value.toUpperCase();
                    const city = document.getElementById('city').value.toUpperCase();
                    let state = document.getElementById('state').value;
                    const zip = document.getElementById('zip').value;
                    const email = document.getElementById('email').value.toUpperCase();
                    const userID = document.getElementById('userID').value.toUpperCase();
                    const pwd = document.getElementById('pwd').value;
                    const cpwd = document.getElementById('cpwd').value;

                    const day = document.getElementById('day').value;
                    const month = document.getElementById('month').value;
                    const year = document.getElementById('year').value;
                    const dob = month + "/" + day + "/" + year;

                    // Prevent the default value for the State dropdown menu from being "State"
                    if (state === "State")
                    {
                        state = "";
                    }

                    // If both passwords do not match, stop further execution of this script
                    if (!checkPWD(pwd, cpwd))
                    {
                        alert("Passwords do not match!");
                        event.preventDefault();
                    }

                    // JSON object
                    const signupData = 
                    {
                        FIRST_NAME: fname,
                        MIDDLE_INIT: mname,
                        LAST_NAME: lname,
                        SUFFIX: suf,
                        DOB: dob,
                        PHONE_NUMBER: phone,
                        STREET: addr,
                        CITY: city,
                        STATE: state,
                        ZIP: zip,
                        EMAIL: email,
                        USER_NAME: userID,
                        PASSWORD: pwd
                    };

                    // Display JSON object as a string in the console and can be sent to the server
                    console.log(JSON.stringify(signupData));

                    const requestData = 
                    {
                        flag: 'signup',
                        signupData: signupData
                    };

                    const xhr = new XMLHttpRequest();
                    xhr.open('POST', '../test/mock-server.php', true);
                    xhr.setRequestHeader('Content-Type', 'application/json');
                    xhr.onload = function()
                    {
                        if (xhr.readyState == 4 && xhr.status == 200) 
                        {
                            const response = JSON.parse(xhr.responseText);
                            console.log(response.message);
                        }
                        else
                        {
                            console.log("Error:", xhr.statusText);
                        }
                    };
                    xhr.onerror = function()
                    {
                        console.error("Network Error");
                    };
                    xhr.send(JSON.stringify(requestData));
                });
            });
        </script>

        <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" 
                integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz" 
                crossorigin="anonymous">
        </script>
    </body>
</html>